<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typing Speed Pro</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #87CEEB; /* Sky blue */
      overflow: auto;
    }
    canvas {
      border: 2px solid #333;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      max-width: 90vw;
      max-height: 85vh;
      width: 100%;
      height: 100%;
    }
    #startButton, #resetButton {
      position: absolute;
      padding: 0.8% 1.6%;
      font-size: calc(0.015 * 100vmin);
      font-family: 'Roboto', sans-serif;
      background-color: rgba(76, 175, 80, 0.7); /* Semi-transparent green */
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.8); /* Semi-transparent white border */
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s, background-color 0.2s;
      width: calc(15vmin); /* Consistent button width */
      box-sizing: border-box;
    }
    #startButton:hover, #resetButton:hover {
      background-color: rgba(69, 160, 73, 0.7); /* Semi-transparent darker green */
      transform: scale(1.05);
    }
    #timerSelect, #wordSizeSelect {
      position: absolute;
      padding: 0.6%;
      font-size: calc(0.013 * 100vmin);
      font-family: 'Roboto', sans-serif;
      border-radius: 5px;
      background-color: #fff;
      border: 2px solid #333;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      width: calc(20vmin);
      box-sizing: border-box;
    }
    #usernameInput {
      position: absolute;
      padding: 0.6%;
      font-size: calc(0.013 * 100vmin);
      font-family: 'Roboto', sans-serif;
      border-radius: 5px;
      background-color: #fff;
      border: 2px solid #333;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      width: calc(20vmin);
      box-sizing: border-box;
    }
    @media (max-width: 600px) {
      #startButton, #resetButton {
        padding: 1.5% 3%;
        font-size: calc(0.011 * 100vmin);
        width: calc(22vmin);
        background-color: rgba(76, 175, 80, 0.7);
        border: 2px solid rgba(255, 255, 255, 0.8);
      }
      #startButton:hover, #resetButton:hover {
        background-color: rgba(69, 160, 73, 0.7);
      }
      #timerSelect, #wordSizeSelect, #usernameInput {
        padding: 1.2%;
        font-size: calc(0.010 * 100vmin);
        width: calc(28vmin);
      }
    }
  </style>
</head>
<body>
  <select id="wordSizeSelect">
    <option value="1" selected>Word Size: 1x</option>
    <option value="2">Word Size: 2x</option>
    <option value="3">Word Size: 3x</option>
    <option value="4">Word Size: 4x</option>
  </select>
  <select id="timerSelect">
    <option value="10">10 seconds</option>
    <option value="20">20 seconds</option>
    <option value="30">30 seconds</option>
    <option value="40">40 seconds</option>
    <option value="50">50 seconds</option>
    <option value="60" selected>60 seconds</option>
    <option value="70">70 seconds</option>
    <option value="80">80 seconds</option>
    <option value="90">90 seconds</option>
  </select>
  <input type="text" id="usernameInput" maxlength="15" placeholder="Enter Username">
  <button id="startButton" onclick="startGame()">Start Game</button>
  <button id="resetButton" onclick="resetGame()" style="display: none;">Reset Game</button>
<script>
let words = [
    "a", "ability", "able", "about", "above", "accept", "according", "account", "across", "act", "action", "activity", "actually", "add", "address",
    "administration", "admit", "adult", "affect", "after", "again", "against", "age", "agency", "agent", "ago", "agree", "agreement", "ahead", "air",
    "all", "allow", "almost", "alone", "along", "already", "also", "although", "always", "american", "among", "amount", "analysis", "and", "animal",
    "another", "answer", "any", "anyone", "anything", "appear", "apply", "approach", "area", "argue", "arm", "around", "arrive", "art", "article",
    "artist", "as", "ask", "assume", "at", "attack", "attention", "attorney", "audience", "author", "authority", "available", "avoid", "away", "baby",
    "back", "bad", "bag", "ball", "bank", "bar", "base", "be", "beat", "beautiful", "because", "become", "bed", "before", "begin", "behavior",
    "behind", "believe", "benefit", "best", "better", "between", "beyond", "big", "bill", "billion", "bit", "black", "blood", "blue", "board", "body",
    "book", "born", "both", "box", "boy", "break", "bring", "brother", "budget", "build", "building", "business", "but", "buy", "by", "call", "camera",
    "campaign", "can", "cancer", "candidate", "capital", "car", "card", "care", "career", "carry", "case", "catch", "cause", "cell", "center",
    "central", "century", "certain", "certainly", "chair", "challenge", "chance", "change", "character", "charge", "check", "child", "choice", "choose",
    "church", "citizen", "city", "civil", "claim", "class", "clear", "clearly", "close", "coach", "cold", "collection", "college", "color", "come",
    "commercial", "common", "community", "company", "compare", "computer", "concern", "condition", "conference", "congress", "consider", "consumer",
    "contain", "continue", "control", "cost", "could", "country", "couple", "course", "court", "cover", "create", "crime", "cultural", "culture", "cup",
    "current", "customer", "cut", "dark", "data", "daughter", "day", "dead", "deal", "death", "debate", "decade", "decide", "decision", "deep",
    "defense", "degree", "democrat", "democratic", "describe", "design", "despite", "detail", "determine", "develop", "development", "die",
    "difference", "different", "difficult", "dinner", "direction", "director", "discover", "discuss", "discussion", "disease", "do", "doctor", "dog",
    "door", "down", "draw", "dream", "drive", "drop", "drug", "during", "each", "early", "east", "easy", "eat", "economic", "economy", "edge",
    "education", "effect", "effort", "eight", "either", "election", "else", "employee", "end", "energy", "enjoy", "enough", "enter", "entire",
    "environment", "environmental", "especially", "establish", "even", "evening", "event", "ever", "every", "everybody", "everyone", "everything",
    "evidence", "exactly", "example", "executive", "exist", "expect", "experience", "expert", "explain", "eye", "face", "fact", "factor", "fail",
    "fall", "family", "far", "fast", "father", "fear", "federal", "feel", "feeling", "few", "field", "fight", "figure", "fill", "film", "final",
    "finally", "financial", "find", "fine", "finger", "finish", "fire", "firm", "first", "fish", "five", "floor", "fly", "focus", "follow", "food",
    "foot", "for", "force", "foreign", "forget", "form", "former", "forward", "four", "free", "friend", "from", "front", "full", "fund", "future",
    "game", "garden", "gas", "general", "generation", "get", "girl", "give", "glass", "go", "goal", "good", "government", "great", "green", "ground",
    "group", "grow", "growth", "guess", "gun", "guy", "hair", "half", "hand", "hang", "happen", "happy", "hard", "have", "he", "head", "health",
    "hear", "heart", "heat", "heavy", "help", "her", "here", "herself", "high", "him", "himself", "his", "history", "hit", "hold", "home", "hope",
    "hospital", "hot", "hotel", "hour", "house", "how", "however", "huge", "human", "hundred", "husband", "i", "idea", "identify", "if", "image",
    "imagine", "impact", "important", "improve", "in", "include", "including", "increase", "indeed", "indicate", "individual", "industry",
    "information", "inside", "instead", "institution", "interest", "interesting", "international", "interview", "into", "investment", "involve",
    "issue", "it", "item", "its", "itself", "job", "join", "just", "keep", "key", "kid", "kill", "kind", "kitchen", "know", "knowledge", "land",
    "language", "large", "last", "late", "later", "laugh", "law", "lawyer", "lay", "lead", "leader", "learn", "least", "leave", "left", "leg",
    "legal", "less", "let", "letter", "level", "lie", "life", "light", "like", "likely", "line", "list", "listen", "little", "live", "local", "long",
    "look", "lose", "loss", "lot", "love", "low", "machine", "magazine", "main", "maintain", "major", "majority", "make", "man", "manage",
    "management", "manager", "many", "market", "marriage", "material", "matter"
];

let fallingWords = [];
let score = 0;
let typedText = '';
let canvasWidth, canvasHeight;
let gameState = 'start';
let baseSpeed = 0.5;
let gameTime = 60;
let startTime;
let correctFlash = 0;
let lives = 5;
let level = 1;
let spawnRate = 5000;
let lastSpawnTime = 0;
let highScore = localStorage.getItem('highScore') || 0;
let username = '';
let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
let clouds = [];
let wordSize = 1;

function setup() {
  canvasWidth = Math.floor(windowWidth * 0.85);
  canvasHeight = Math.floor(windowHeight * 0.85);
  let canvas = createCanvas(canvasWidth, canvasHeight);
  canvas.style('max-width', '90vw');
  canvas.style('max-height', '85vh');
  textFont('Roboto');
  textAlign(LEFT);
  for (let i = 0; i < 6; i++) {
    clouds.push({
      x: random(canvasWidth),
      y: random(canvasHeight * 0.1, canvasHeight * 0.5),
      size: random(50, 100),
      speed: random(0.5, 2)
    });
  }
  updateUIElementPositions();
  windowResized();
}

function windowResized() {
  canvasWidth = Math.floor(windowWidth * 0.85);
  canvasHeight = Math.floor(windowHeight * 0.85);
  resizeCanvas(canvasWidth, canvasHeight);
  textSize(Math.floor(canvasHeight * 0.033));
  for (let cloud of clouds) {
    cloud.x = constrain(cloud.x, -cloud.size, canvasWidth + cloud.size);
    cloud.y = constrain(cloud.y, canvasHeight * 0.1, canvasHeight * 0.5);
    cloud.size = map(cloud.size, 50, 100, canvasHeight * 0.05, canvasHeight * 0.1);
  }
  for (let word of fallingWords) {
    // Set text size for width calculation
    textSize(Math.floor(canvasHeight * 0.033 * wordSize));
    let wordWidth = textWidth(word.text);
    word.x = constrain(word.x, 50, canvasWidth - wordWidth - 50);
    word.y = constrain(word.y, 0, canvasHeight);
  }
  // Increased delay for stable UI updates
  setTimeout(updateUIElementPositions, 200);
}

function updateUIElementPositions() {
  let canvas = document.querySelector('canvas');
  if (!canvas) return; // Prevent errors if canvas is not yet available
  let rect = canvas.getBoundingClientRect();
  let button = document.getElementById('startButton');
  let resetButton = document.getElementById('resetButton');
  let timerSelect = document.getElementById('timerSelect');
  let wordSizeSelect = document.getElementById('wordSizeSelect');
  let input = document.getElementById('usernameInput');

  // Use computed style for more reliable width calculation
  function getElementWidth(element, vminStr) {
    if (element && element.offsetWidth) return element.offsetWidth;
    let computedWidth = parseFloat(window.getComputedStyle(element).width);
    if (!isNaN(computedWidth)) return computedWidth;
    return calcWidth(vminStr); // Fallback
  }

  // Adjust gaps for better spacing, especially on mobile
  let gapMultiplier = window.innerWidth <= 600 ? 0.08 : 0.07;

  if (wordSizeSelect) {
    wordSizeSelect.style.top = `${rect.top + canvasHeight * 0.50}px`;
    wordSizeSelect.style.left = `${rect.left + (canvasWidth - getElementWidth(wordSizeSelect, '20vmin')) / 2}px`;
  }
  if (timerSelect) {
    timerSelect.style.top = `${rect.top + canvasHeight * (0.50 + gapMultiplier)}px`;
    timerSelect.style.left = `${rect.left + (canvasWidth - getElementWidth(timerSelect, '20vmin')) / 2}px`;
  }
  if (input) {
    input.style.top = `${rect.top + canvasHeight * (0.50 + 2 * gapMultiplier)}px`;
    input.style.left = `${rect.left + (canvasWidth - getElementWidth(input, '20vmin')) / 2}px`;
  }
  if (button) {
    button.style.top = `${rect.top + canvasHeight * (0.50 + 3 * gapMultiplier)}px`;
    button.style.left = `${rect.left + (canvasWidth - getElementWidth(button, '15vmin')) / 2}px`;
  }
  if (resetButton) {
    resetButton.style.top = `${rect.top + canvasHeight * (0.50 + 4 * gapMultiplier)}px`;
    resetButton.style.left = `${rect.left + (canvasWidth - getElementWidth(resetButton, '15vmin')) / 2}px`;
  }
}

// Helper function to calculate width in pixels from vmin
function calcWidth(vminStr) {
  let vmin = parseFloat(vminStr) * Math.min(window.innerWidth, window.innerHeight) / 100;
  return vmin;
}

function draw() {
  background(135, 206, 235);
  noStroke();
  fill(255, 255, 255, 150);
  for (let cloud of clouds) {
    ellipse(cloud.x, cloud.y, cloud.size, cloud.size * 0.6);
    ellipse(cloud.x + cloud.size * 0.4, cloud.y - cloud.size * 0.2, cloud.size * 0.8, cloud.size * 0.5);
    ellipse(cloud.x - cloud.size * 0.4, cloud.y + cloud.size * 0.1, cloud.size * 0.7, cloud.size * 0.4);
    ellipse(cloud.x + cloud.size * 0.2, cloud.y + cloud.size * 0.2, cloud.size * 0.6, cloud.size * 0.3);
    cloud.x += cloud.speed;
    if (cloud.x > canvasWidth + cloud.size) {
      cloud.x = -cloud.size;
      cloud.y = random(canvasHeight * 0.1, canvasHeight * 0.5);
    }
  }

  if (gameState === 'start') {
    fill(0, 0, 0, 150);
    rect(0, 0, canvasWidth, canvasHeight);
    fill(255);
    textAlign(CENTER);
    textSize(Math.floor(canvasHeight * 0.053));
    textStyle(BOLD);
    text('Typing Speed Pro', canvasWidth / 2, canvasHeight * 0.20);
    textSize(Math.floor(canvasHeight * 0.033));
    textStyle(NORMAL);
    text('Select Word Size, Time, Enter Username, and Click Start', canvasWidth / 2, canvasHeight * 0.25);
    textAlign(LEFT);
    textSize(Math.floor(canvasHeight * 0.025));
    text('Created by Loqic', canvasWidth * 0.0167, canvasHeight * 0.95);
    document.getElementById('startButton').style.display = 'block';
    document.getElementById('wordSizeSelect').style.display = 'block';
    document.getElementById('timerSelect').style.display = 'block';
    document.getElementById('usernameInput').style.display = 'block';
    document.getElementById('resetButton').style.display = 'none';
  } else if (gameState === 'playing') {
    if (correctFlash > 0) {
      fill(50, 205, 50, correctFlash * 10);
      rect(0, 0, canvasWidth, canvasHeight);
      correctFlash--;
    }

    let elapsedTime = (millis() - startTime) / 1000;
    let remainingTime = Math.max(0, gameTime - elapsedTime);

    fill(0);
    textSize(Math.floor(canvasHeight * 0.033));
    textStyle(BOLD);
    drawingContext.shadowColor = 'rgba(0,0,0,0.5)';
    drawingContext.shadowBlur = 5;
    text('Score: ' + score, canvasWidth * 0.0167, canvasHeight * 0.05);
    text('Time: ' + Math.floor(remainingTime), canvasWidth * 0.0167, canvasHeight * 0.15);
    text('Lives: ' + lives, canvasWidth * 0.0167, canvasHeight * 0.2);
    text('Level: ' + level, canvasWidth * 0.0167, canvasHeight * 0.25);
    text('Typing: ' + typedText, canvasWidth * 0.0167, canvasHeight * 0.1);
    drawingContext.shadowBlur = 0;

    let now = millis();
    if (now - lastSpawnTime > spawnRate && fallingWords.length < 3) {
      addNewWord();
      lastSpawnTime = now;
    }

    for (let i = fallingWords.length - 1; i >= 0; i--) {
      let word = fallingWords[i];
      word.y += word.speed;
      word.angle += 0.01;
      push();
      translate(word.x, word.y);
      rotate(Math.sin(word.angle) * 0.1);

      let currentX = 0;
      textSize(Math.floor(canvasHeight * 0.033 * wordSize));
      for (let j = 0; j < word.text.length; j++) {
        let letter = word.text[j];
        let isCorrect = j < typedText.length && typedText[j].toLowerCase() === letter.toLowerCase();
        let isIncorrect = j < typedText.length && typedText[j].toLowerCase() !== letter.toLowerCase();
        fill(isCorrect ? color(0, 255, 0) : isIncorrect ? color(255, 0, 0) : color(255, 165, 0));
        textStyle(BOLD);
        drawingContext.shadowColor = 'rgba(0,0,0,0.5)';
        drawingContext.shadowBlur = 3;
        text(letter, currentX, 0);
        currentX += textWidth(letter);
      }
      pop();

      if (word.y > canvasHeight) {
        fallingWords.splice(i, 1);
        lives--;
        if (lives <= 0) {
          gameState = 'gameOver';
          typedText = '';
          let existingIndex = leaderboard.findIndex(entry => entry.user.toLowerCase() === username.toLowerCase());
          if (existingIndex !== -1) {
            leaderboard[existingIndex].score = score;
          } else {
            leaderboard.push({user: username, score: score});
          }
          leaderboard.sort((a, b) => b.score - a.score);
          leaderboard = leaderboard.slice(0, 10);
          localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
          if (score > highScore) {
            highScore = score;
            localStorage.setItem('highScore', highScore);
          }
        } else {
          addNewWord();
        }
      }
    }

    if (remainingTime <= 0) {
      gameState = 'gameOver';
      typedText = '';
      let existingIndex = leaderboard.findIndex(entry => entry.user.toLowerCase() === username.toLowerCase());
      if (existingIndex !== -1) {
        leaderboard[existingIndex].score = score;
      } else {
        leaderboard.push({user: username, score: score});
      }
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 10);
      localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
      }
    }
  } else if (gameState === 'gameOver') {
    fill(0, 0, 0, 150);
    rect(0, 0, canvasWidth, canvasHeight);
    fill(255);
    textAlign(CENTER);
    textSize(Math.floor(canvasHeight * 0.053));
    textStyle(BOLD);
    text('Game Over!', canvasWidth / 2, canvasHeight * 0.20);
    textSize(Math.floor(canvasHeight * 0.033));
    textStyle(NORMAL);
    text('Final Score: ' + score, canvasWidth / 2, canvasHeight * 0.25);
    text('High Score: ' + highScore, canvasWidth / 2, canvasHeight * 0.30);
    
    // Draw leaderboard table
    let tableX = canvasWidth * 0.85;
    let tableY = canvasHeight * 0.05;
    let rowHeight = canvasHeight * 0.035;
    let rankWidth = canvasWidth * 0.06;
    let userWidth = canvasWidth * 0.12;
    let scoreWidth = canvasWidth * 0.07;
    let tableWidth = rankWidth + userWidth + scoreWidth;
    
    // Table background
    fill(255, 255, 255, 200);
    rect(tableX - tableWidth / 2, tableY, tableWidth, rowHeight * (Math.min(5, leaderboard.length) + 1), 10);
    
    // Table header
    fill(0);
    textSize(Math.floor(canvasHeight * 0.020));
    textStyle(BOLD);
    drawingContext.shadowColor = 'rgba(0,0,0,0.5)';
    drawingContext.shadowBlur = 3;
    textAlign(LEFT);
    text('Rank', tableX - tableWidth / 2 + 6, tableY + rowHeight * 0.7);
    text('Username', tableX - tableWidth / 2 + rankWidth + 6, tableY + rowHeight * 0.7);
    text('Score', tableX - tableWidth / 2 + rankWidth + userWidth + 6, tableY + rowHeight * 0.7);
    
    // Table rows
    textStyle(NORMAL);
    for (let i = 0; i < Math.min(5, leaderboard.length); i++) {
      let y = tableY + rowHeight * (i + 1);
      text(`${i + 1}`, tableX - tableWidth / 2 + 6, y + rowHeight * 0.7);
      text(leaderboard[i].user, tableX - tableWidth / 2 + rankWidth + 6, y + rowHeight * 0.7);
      text(leaderboard[i].score, tableX - tableWidth / 2 + rankWidth + userWidth + 6, y + rowHeight * 0.7);
    }
    
    // Table grid lines
    stroke(0);
    strokeWeight(1);
    line(tableX - tableWidth / 2, tableY + rowHeight, tableX + tableWidth / 2, tableY + rowHeight);
    for (let i = 0; i < Math.min(5, leaderboard.length); i++) {
      line(tableX - tableWidth / 2, tableY + rowHeight * (i + 2), tableX + tableWidth / 2, tableY + rowHeight * (i + 2));
    }
    line(tableX - tableWidth / 2 + rankWidth, tableY, tableX - tableWidth / 2 + rankWidth, tableY + rowHeight * (Math.min(5, leaderboard.length) + 1));
    line(tableX - tableWidth / 2 + rankWidth + userWidth, tableY, tableX - tableWidth / 2 + rankWidth + userWidth, tableY + rowHeight * (Math.min(5, leaderboard.length) + 1));
    noStroke();
    
    textAlign(CENTER);
    textSize(Math.floor(canvasHeight * 0.033));
    text('Select Word Size, Time, Enter Username, and Click Start or Reset', canvasWidth / 2, canvasHeight * 0.80);
    textAlign(LEFT);
    textSize(Math.floor(canvasHeight * 0.025));
    text('Created by Loqic', canvasWidth * 0.0167, canvasHeight * 0.95);
    drawingContext.shadowBlur = 0;
    document.getElementById('startButton').style.display = 'block';
    document.getElementById('wordSizeSelect').style.display = 'block';
    document.getElementById('timerSelect').style.display = 'block';
    document.getElementById('usernameInput').style.display = 'block';
    document.getElementById('resetButton').style.display = 'block';
  }
}

function keyPressed() {
  if (gameState === 'playing') {
    if (keyCode === BACKSPACE) {
      typedText = typedText.slice(0, -1);
    } else if (key >= 'a' && key <= 'z' || key >= 'A' && key <= 'Z') {
      typedText += key;
      checkTypedWord();
    }
  }
}

function addNewWord() {
  let wordText = random(words);
  // Set text size to calculate width
  textSize(Math.floor(canvasHeight * 0.033 * wordSize));
  let wordWidth = textWidth(wordText);
  let word = {
    text: wordText,
    x: random(Math.max(0, 50 - wordWidth / 2), Math.max(0, canvasWidth - wordWidth - 50)),
    y: 0,
    speed: baseSpeed,
    angle: 0
  };
  fallingWords.push(word);
}

function checkTypedWord() {
  let maxWordLength = Math.max(...fallingWords.map(w => w.text.length), 0);
  for (let i = fallingWords.length - 1; i >= 0; i--) {
    if (typedText.length === fallingWords[i].text.length && 
        fallingWords[i].text.toLowerCase() === typedText.toLowerCase()) {
      fallingWords.splice(i, 1);
      score += 10;
      typedText = '';
      correctFlash = 10;
      if (score / 30 >= level) {
        level++;
        baseSpeed += 0.2;
        spawnRate = Math.max(1000, spawnRate - 500);
      }
      addNewWord();
      return;
    }
  }
  if (typedText.length >= maxWordLength) {
    typedText = '';
  }
}

function startGame() {
  username = document.getElementById('usernameInput').value.trim();
  if (!username) return;
  wordSize = parseFloat(document.getElementById('wordSizeSelect').value);
  gameState = 'playing';
  document.getElementById('startButton').style.display = 'none';
  document.getElementById('wordSizeSelect').style.display = 'none';
  document.getElementById('timerSelect').style.display = 'none';
  document.getElementById('usernameInput').style.display = 'none';
  document.getElementById('resetButton').style.display = 'none';
  fallingWords = [];
  score = 0;
  typedText = '';
  baseSpeed = 0.5;
  spawnRate = 5000;
  level = 1;
  lives = 5;
  gameTime = parseInt(document.getElementById('timerSelect').value);
  startTime = millis();
  lastSpawnTime = millis();
  addNewWord();
}

function resetGame() {
  leaderboard = [];
  highScore = 0;
  localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
  localStorage.setItem('highScore', 0);
  gameState = 'start';
  fallingWords = [];
  score = 0;
  typedText = '';
  baseSpeed = 0.5;
  spawnRate = 5000;
  level = 1;
  lives = 5;
  username = '';
  document.getElementById('usernameInput').value = '';
  document.getElementById('startButton').style.display = 'block';
  document.getElementById('wordSizeSelect').style.display = 'block';
  document.getElementById('timerSelect').style.display = 'block';
  document.getElementById('usernameInput').style.display = 'block';
  document.getElementById('resetButton').style.display = 'none';
  updateUIElementPositions();
}
</script>
</body>
</html>